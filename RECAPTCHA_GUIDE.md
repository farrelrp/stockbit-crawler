# reCAPTCHA Token Guide

Stockbit uses **reCAPTCHA v3** for login authentication. This means every login request requires a verification token generated by Google's reCAPTCHA service.

## The Problem

reCAPTCHA v3 tokens are generated client-side using Google's JavaScript library. They can't be easily generated from Python backend code because:

1. Google validates the origin (must come from stockbit.com domain)
2. Tokens are short-lived (typically valid for 2 minutes)
3. They include browser fingerprinting data

## Solution Options

### Option 1: Get Token from Browser (Recommended for Testing)

**Steps:**

1. **Open Stockbit Login Page**
   - Go to https://stockbit.com/login in your browser
   - Open Developer Tools (F12)

2. **Open Console Tab**
   - In DevTools, click on "Console" tab

3. **Execute reCAPTCHA**
   - In the console, paste this code:
   ```javascript
   grecaptcha.execute('6LcOuysTAAAAAHTjFuqhA-egan4CL9BieDa9z5B_', {action: 'login'})
     .then(token => {
       console.log('Token:', token);
       // copy this token
     });
   ```

4. **Copy the Token**
   - The console will print a long token string
   - Copy this entire token

5. **Use in API Call**
   - When calling `/api/login`, include the token:
   ```json
   {
     "email": "your@email.com",
     "password": "yourpassword",
     "recaptcha_token": "PASTE_TOKEN_HERE",
     "save_credentials": true
   }
   ```

**Note:** Tokens expire after ~2 minutes, so you need to generate a fresh one each time.

### Option 2: Browser DevTools Network Tab

**Steps:**

1. Open https://stockbit.com/login
2. Open DevTools (F12) → Network tab
3. Enter your credentials and click Login
4. Find the `login/email` request in Network tab
5. Click on it → Payload tab
6. Copy the `verificationToken` value
7. Use this token in your API call

**Important:** This token is already used, but you can see the format. For fresh tokens, use Option 1.

### Option 3: Integrate reCAPTCHA in Frontend (Production Solution)

For a production app, you should integrate reCAPTCHA properly in your frontend:

**1. Add reCAPTCHA Script to Settings Page**

Add to `templates/settings.html` in the `<head>` section:
```html
<script src="https://www.google.com/recaptcha/api.js?render=6LcOuysTAAAAAHTjFuqhA-egan4CL9BieDa9z5B_"></script>
```

**2. Modify Login Form Submission**

Update the form submission in `templates/settings.html`:
```javascript
document.getElementById('credentials-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const saveCredentials = document.getElementById('save-credentials').checked;
    
    // Execute reCAPTCHA
    grecaptcha.execute('6LcOuysTAAAAAHTjFuqhA-egan4CL9BieDa9z5B_', {action: 'login'})
        .then(function(token) {
            // Send login request with token
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: email,
                    password: password,
                    recaptcha_token: token,
                    save_credentials: saveCredentials
                })
            })
            .then(r => r.json())
            .then(data => {
                // handle response
                if (data.success) {
                    showNotification('Login successful!', 'success');
                } else {
                    showNotification('Login failed: ' + data.error, 'error');
                }
            });
        });
});
```

### Option 4: Use Selenium/Browser Automation

For automated workflows, you can use Selenium to:
1. Open Stockbit login page
2. Execute JavaScript to get reCAPTCHA token
3. Use the token in your API calls

**Example with Selenium:**
```python
from selenium import webdriver
from selenium.webdriver.common.by import By
import time

def get_recaptcha_token():
    driver = webdriver.Chrome()
    driver.get('https://stockbit.com/login')
    time.sleep(2)
    
    # Execute reCAPTCHA
    token = driver.execute_script("""
        return grecaptcha.execute('6LcOuysTAAAAAHTjFuqhA-egan4CL9BieDa9z5B_', {action: 'login'});
    """)
    
    driver.quit()
    return token

# Use it
token = get_recaptcha_token()
# Now use this token in your login API call
```

## Current App Behavior

The app is configured to:
1. Try login without reCAPTCHA token (will likely fail)
2. Detect reCAPTCHA requirement in response
3. Show error message indicating reCAPTCHA is needed

For class demo purposes, you can:
- Get token manually from browser (Option 1)
- Make API call with curl or Postman including the token
- Or integrate Option 3 for a complete solution

## Why This Matters

reCAPTCHA v3 is a security feature that:
- Prevents automated bot attacks
- Protects against credential stuffing
- Validates that requests come from real browsers

For educational purposes, understanding this is valuable for:
- Learning about web security
- Understanding client-server authentication flows
- Working with third-party security services
- Dealing with real-world API constraints

## Recommendation for Your Project

**For Demo/Testing:**
- Use Option 1 (get token from browser console)
- Document this in your project report as a known limitation
- Explain that production apps would integrate reCAPTCHA properly

**For Full Implementation:**
- Implement Option 3 (integrate reCAPTCHA in frontend)
- This shows understanding of complete web authentication flow
- More impressive for your lecturer

## Site Key

The Stockbit reCAPTCHA site key is:
```
6LcOuysTAAAAAHTjFuqhA-egan4CL9BieDa9z5B_
```

This is the public key visible in browser requests and is safe to share.

